require=function r(c,o,s){function l(t,e){if(!o[t]){if(!c[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(d)return d(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[t]={exports:{}};c[t][0].call(i.exports,function(e){return l(c[t][1][e]||e)},i,i.exports,r,c,o,s)}return o[t].exports}for(var d="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({GameOverRank:[function(e,t,a){"use strict";cc._RF.push(t,"84926x/a69PqI8CKDlYDJvq","GameOverRank"),cc.Class({extends:cc.Component,properties:{rankLabel:cc.Label,avatarImgSprite:cc.Sprite,nickLabel:cc.Label,topScoreLabel:cc.Label},start:function(){},init:function(e,t,a){var n=t.avatarUrl,i=t.nickname.length<=10?t.nickname:t.nickname.substr(0,10)+"...",r=0!=t.KVDataList.length?t.KVDataList[0].value:0;this.rankLabel.string=(e+1).toString(),this.createImage(n),this.nickLabel.string=i,this.topScoreLabel.string=r.toString()},initF:function(e){var t=e.avatarUrl,a=e.nickname.length<=5?e.nickname:e.nickname.substr(0,5)+"...",n=0!=e.KVDataList.length?e.KVDataList[0].value:0;this.createImage(t),this.nickLabel.string=a,this.topScoreLabel.string=this.change(n)},change:function(e){return 1e5<e?(e/1e4).toFixed(0)+"万":e},createImage:function(e){var t=this;try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(e)}catch(e){t.avatarImgSprite.node.active=!1}},a.src=e}catch(e){this.avatarImgSprite.node.active=!1}}}),cc._RF.pop()},{}],GameRankingList:[function(e,t,a){"use strict";cc._RF.push(t,"280c3rsZJJKnZ9RqbALVwtK","GameRankingList"),cc.Class({extends:cc.Component,properties:{rankingScrollView:cc.ScrollView,scrollViewContent:cc.Node,prefabRankItem:cc.Prefab,prefabGameOverRank:cc.Prefab,gameOverRankLayout:cc.Node,loadingLabel:cc.Node,bottomNode:cc.Node,friendScoreItem:cc.Node},start:function(){var t=this;this.removeChild(),window.wx.onMessage(function(e){t.friendScoreItem.active=!1,t.loadingLabel.active=!1,0==e.messageType?t.removeChild():1==e.messageType?(t.loadingLabel.active=!0,t.fetchFriendData(e.MAIN_MENU_NUM)):3==e.messageType?(t.friendScoreItem.active=!0,t.submitScore(e.MAIN_MENU_NUM,e.score)):4==e.messageType?t.gameOverRank(e.MAIN_MENU_NUM):5==e.messageType?t.fetchGroupFriendData(e.MAIN_MENU_NUM,e.shareTicket):6==e.messageType&&(t.friendScoreItem.active=!0,t.updateFdScore(e.MAIN_MENU_NUM,e.score,e.isStart))})},showTip:function(){this.loadingLabel.string="玩命加载中...",this.loadingLabel.active=!1},submitScore:function(t,a){window.wx.getUserCloudStorage({keyList:["x"+t],success:function(e){0!=e.KVDataList.length&&(1==t&&window.wx.setUserCloudStorage({KVDataList:[{key:"Classic",value:'{"wxgame":{"score":'+(e.KVDataList[0].value>a?e.KVDataList[0].value:a)+',"update_time": '+(new Date).getTime()+"}}"}]}),e.KVDataList[0].value>a)||window.wx.setUserCloudStorage({KVDataList:[{key:"x"+t,value:""+a}],success:function(e){},fail:function(e){},complete:function(e){}})},fail:function(e){},complete:function(e){}})},removeChild:function(){this.rankingScrollView.node.active=!1,this.scrollViewContent.removeAllChildren(),this.gameOverRankLayout.active=!1,this.gameOverRankLayout.removeAllChildren(),this.bottomNode.removeAllChildren()},fetchFriendData:function(t){var r=this;this.removeChild(),this.rankingScrollView.node.active=!0,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){r.loadingLabel.active=!1;e.data[0];wx.getFriendCloudStorage({keyList:["x"+t],success:function(e){var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var a=0;a<t.length;a++){var n=t[a],i=cc.instantiate(r.prefabRankItem);i.getComponent("RankItem").init(a,n),r.scrollViewContent.addChild(i)}},fail:function(e){r.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){r.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fetchGroupFriendData:function(t,a){var r=this;this.removeChild(),this.rankingScrollView.node.active=!0,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){e.data[0];wx.getGroupCloudStorage({shareTicket:a,keyList:["x"+t],success:function(e){r.loadingLabel.active=!1;var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var a=0;a<t.length;a++){var n=t[a],i=cc.instantiate(r.prefabRankItem);i.getComponent("RankItem").init(a,n),r.scrollViewContent.addChild(i)}},fail:function(e){r.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){r.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},gameOverRank:function(t){var d=this;this.removeChild(),this.gameOverRankLayout.active=!0,this.gameOverRankLayout.removeAllChildren(),wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){var l=e.data[0];wx.getFriendCloudStorage({keyList:["x"+t],success:function(e){d.loadingLabel.active=!1;var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var a=0;a<t.length;a++)if(t[a].avatarUrl==l.avatarUrl){if(0<=a-1){if(a+1>=t.length&&0<=a-2){var n=cc.instantiate(d.prefabGameOverRank);n.getComponent("GameOverRank").init(a-2,t[a-2]),d.gameOverRankLayout.addChild(n)}var i=cc.instantiate(d.prefabGameOverRank);i.getComponent("GameOverRank").init(a-1,t[a-1]),d.gameOverRankLayout.addChild(i)}else if(a+2>=t.length){var r=new cc.Node;r.width=200,d.gameOverRankLayout.addChild(r)}var c=cc.instantiate(d.prefabGameOverRank);if(c.getComponent("GameOverRank").init(a,t[a],!0),d.gameOverRankLayout.addChild(c),a+1<t.length){var o=cc.instantiate(d.prefabGameOverRank);if(o.getComponent("GameOverRank").init(a+1,t[a+1]),d.gameOverRankLayout.addChild(o),a-1<0&&a+2<t.length){var s=cc.instantiate(d.prefabGameOverRank);s.getComponent("GameOverRank").init(a+2,t[a+2]),d.gameOverRankLayout.addChild(s)}}}},fail:function(e){d.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){d.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},updateFdScore:function(a,n,e){e&&this.removeChild();var i=this;null==i.fdScoreData||e?wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){var t=e.data[0];i.userData=t,wx.getFriendCloudStorage({keyList:["x"+a],success:function(e){var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),i.fdScoreData=t,i.cyIndex=t.length-1,i.showFdItem(n,i.fdScoreData)}})}}):i.showFdItem(n,i.fdScoreData)},showFdItem:function(e,t){for(var a=t.length-1;0<=a;a--)if(e<t[a].KVDataList[0].value){this.loadingLabel.active=!1,this.friendScoreItem.getComponent("GameOverRank").initF(t[a]);break}}}),cc._RF.pop()},{}],RankItem:[function(e,t,a){"use strict";cc._RF.push(t,"1301adTGIlGiqlhF7Px+rDN","RankItem"),cc.Class({extends:cc.Component,properties:{backSprite:cc.Node,rankLabel:cc.Label,avatarImgSprite:cc.Sprite,nickLabel:cc.Label,topScoreLabel:cc.Label,topSprite:cc.Node},start:function(){},init:function(e,t){var a=this,n=t.avatarUrl,i=t.nickname,r=0!=t.KVDataList.length?t.KVDataList[0].value:0;if(e%2==0&&(this.backSprite.color=new cc.Color(55,55,55,255)),e<3){this.topSprite.active=!0,this.rankLabel.node.active=!1;var c="res/top"+(e+1);cc.loader.loadRes(c,cc.SpriteFrame,function(e,t){a.topSprite.getComponent(cc.Sprite).spriteFrame=t})}else this.topSprite.active=!1,this.rankLabel.node.active=!0,this.rankLabel.string=(e+1).toString();this.createImage(n),this.nickLabel.string=i,this.topScoreLabel.string=this.change(r)},change:function(e){return 1e5<e?(e/1e4).toFixed(0)+"万":e},loadImg:function(){},createImage:function(e){var t=this;try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(e)}catch(e){t.avatarImgSprite.node.active=!1}},a.src=e}catch(e){this.avatarImgSprite.node.active=!1}}}),cc._RF.pop()},{}]},{},["GameOverRank","GameRankingList","RankItem"]);